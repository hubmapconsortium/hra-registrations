#!/bin/bash

# List of HuBMAP sample IDs
declare -a ids=(
  "HBM799.QWLQ.586"
  "HBM672.FXXC.728"
  "HBM285.SRTL.889"
  "HBM487.BBDJ.936"
  "HBM353.WXCP.267"
  "HBM924.RGDG.483"
  "HBM623.KJGR.642"
  "HBM278.XLBD.662"
  "HBM533.XLXF.795"
  "HBM872.TSRG.986"
  "HBM489.JQWW.586"
  "HBM466.LBZB.849"
  "HBM379.LNSK.525"
  "HBM648.HNMT.824"
  "HBM939.ZDBQ.785"
  "HBM695.FRXZ.228"
  "HBM287.SBVS.723"
  "HBM865.JCSK.882"
  "HBM959.HTRP.236"
  "HBM337.XFSG.666"
  "HBM428.BWRD.925"
  "HBM765.PNFD.598"
  "HBM777.LWJN.259"
  "HBM749.KLJP.222"
  "HBM764.TCJN.573"
  "HBM644.XFGJ.857"
  "HBM385.QFHD.475"
  "HBM334.CHVK.238"
  "HBM587.DFCW.749"
  "HBM995.CQKZ.339"
  "HBM966.WGFQ.597"
  "HBM692.LCNB.765"
  "HBM792.WJLJ.923"
  "HBM256.MTWQ.585"
  "HBM568.LZHR.425"
  "HBM635.XWKL.465"
  "HBM269.BZSG.442"
  "HBM344.WNWT.887"
  "HBM399.TBPX.343"
  "HBM235.XDSM.559"
  "HBM726.SXHR.776"
  "HBM779.SKXG.842"
  "HBM324.HZVF.467"
  "HBM952.WQNQ.772"
  "HBM567.DVNV.954"
  "HBM779.WMBJ.259"
  "HBM337.QSBH.972"
  "HBM927.XWTL.358"
  "HBM724.GMZM.797"
  "HBM367.JCKP.625"
  "HBM773.MKCR.985"
  "HBM947.XDKM.768"
  "HBM863.NCVL.825"
  "HBM758.KNGF.866"
  "HBM479.GRRC.878"
  "HBM332.QKWS.625"
  "HBM374.SRZD.953"
  "HBM252.QVCK.893"
  "HBM495.WLDR.795"
  "HBM588.TNGJ.868"
  "HBM924.KTQF.774"
  "HBM298.NXHR.528"
  "HBM455.DCGV.562"
  "HBM754.LXMB.975"
  "HBM634.TSZQ.288"
  "HBM236.RPHZ.924"
  "HBM387.BHCS.282"
  "HBM953.DKKW.389"
  "HBM235.FZDT.382"
  "HBM978.MDWW.278"
  "HBM992.ZLZB.786"
  "HBM759.ZTGN.372"
  "HBM379.BGFQ.837"
  "HBM264.TKQN.626"
  "HBM495.CHDG.737"
  "HBM553.HRBR.567"
  "HBM888.ZGTM.434"
  "HBM553.WNFJ.668"
  "HBM882.MCHD.457"
  "HBM734.QQXM.932"
  "HBM575.MXPN.969"
  "HBM259.PRLN.377"
  "HBM847.JWMZ.742"
  "HBM466.QQRB.387"
  "HBM356.HGKJ.573"
  "HBM438.NRLH.282"
  "HBM589.ZMGW.584"
  "HBM765.LQQR.483"
  "HBM924.MLQQ.543"
  "HBM254.FFSR.893"
  "HBM695.LNDL.539"
  "HBM972.QMDB.665"
  "HBM983.HJCH.728"
  "HBM258.LPXQ.626"
  "HBM835.QGBN.256"
  "HBM724.NCFV.667"
  "HBM553.WQWN.884"
  "HBM776.DNJZ.945"
  "HBM459.VMJC.864"
  "HBM932.LWTP.253"
  "HBM288.ZRRP.837"
  "HBM393.CWNW.323"
  "HBM527.XDKX.652"
  "HBM626.NTDP.464"
  "HBM997.PNFL.384"
  "HBM274.XLXT.396"
  "HBM496.KWGJ.958"
  "HBM897.DBTQ.278"
  "HBM589.LCLB.675"
  "HBM878.NKRD.966"
  "HBM798.NZCN.244"
  "HBM547.XHWT.259"
  "HBM359.LMMX.954"
  "HBM699.HPRM.256"
  "HBM236.SCJT.743"
  "HBM756.LMDM.653"
  "HBM537.RTQD.243"
  "HBM275.HNJP.353"
  "HBM559.ZTZP.945"
  "HBM353.GFJR.228"
  "HBM973.DQTR.568"
  "HBM389.ZDTG.259"
  "HBM946.XPHR.294"
  "HBM569.QFBX.255"
  "HBM469.WBDB.236"
  "HBM472.TKPC.695"
  "HBM997.HRCG.585"
  "HBM524.JPDZ.355"
  "HBM848.NRQS.525"
  "HBM943.BCDD.564"
  "HBM775.NSFR.938"
  "HBM266.FTVW.363"
  "HBM454.KDVK.822"
  "HBM657.BWGV.752"
  "HBM374.KHMG.723"
  "HBM757.HGNZ.577"
  "HBM263.FMSF.843"
  "HBM859.TQFB.675"
  "HBM275.JHHR.485"
  "HBM372.ZGVB.958"
  "HBM634.KXMR.248"
  "HBM794.WZTX.678"
  "HBM787.XVBB.778"
  "HBM224.TTJB.522"
  "HBM946.VQKL.632"
  "HBM888.FVGP.722"
  "HBM367.VSDK.374"
  "HBM864.QFTF.838"
  "HBM824.BCPM.928"
  "HBM369.WRDC.345"
  "HBM353.RTXH.756"
  "HBM229.KRZG.433"
  "HBM727.WSZX.242"
  "HBM255.FFJQ.856"
  "HBM474.TQQQ.496"
  "HBM785.MVWL.456"
  "HBM827.MZXW.224"
  "HBM299.VQZH.986"
  "HBM256.ZGQF.566"
  "HBM327.HPJM.473"
  "HBM366.WHRH.745"
  "HBM366.BVQC.294"
  "HBM762.SPJF.928"
)

# Base URL for the HuBMAP entity API
base_url="https://entity.api.hubmapconsortium.org"

# Loop through each sample ID and follow ancestors to find the donor
for id in "${ids[@]}"
do
  current_id=${id}
  while true; do
    response=$(curl -s -w "\n%{http_code}" -X GET "${base_url}/entities/${current_id}" -H "Accept: application/json" -H "Authorization: Bearer AgMNpnNPrVj4Yga1OvzwMKKVggymYdaye3Xb0VoDYPQpmVE9MJhOC2ybm670wjYnGKba57jrj0kenGca8DrG0cd0KyX")
    http_code=$(echo "$response" | tail -n 1)
    body=$(echo "$response" | sed '$d')

    if [ "$http_code" -eq 200 ]; then
      entity_type=$(echo "$body" | jq -r '.entity_type')
      if [ "$entity_type" == "Donor" ]; then
        donor_id=$(echo "$body" | jq -r '.hubmap_id')
        echo "https://portal.hubmapconsortium.org/browse/${donor_id}"
        break
      elif [ "$entity_type" == "Sample" ]; then
        direct_ancestor=$(echo "$body" | jq -r '.direct_ancestor.hubmap_id')
        if [ -n "$direct_ancestor" ] && [ "$direct_ancestor" != "null" ]; then
          current_id=$direct_ancestor
        else
          break
        fi
      else
        break
      fi
    else
      break
    fi
  done
done
